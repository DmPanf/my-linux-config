#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä—è–µ–º SSH —Å–µ—Å—Å–∏—é
if [ -n "$SSH_CLIENT" ]; then

    # –ö–æ–Ω—Ñ–∏–≥ (–ù–æ–≤—ã–π –ø—É—Ç—å)
    CONFIG="/etc/default/tg_bot.env"
    [ -f "$CONFIG" ] && source "$CONFIG"

    # –î–∞–Ω–Ω—ã–µ
    CLIENT_IP=$(echo $SSH_CLIENT | awk '{print $1}')
    SRV_NAME="${host:-$(hostname)}"
    USER_LOGIN=$(whoami)

    # –°–æ–æ–±—â–µ–Ω–∏–µ (HTML)
    MSG="üîê SSH: <b>$USER_LOGIN</b> ‚û°Ô∏è <b>$SRV_NAME</b> [$CLIENT_IP]"

    # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ñ–æ–Ω–µ
    (
      if [ -n "$TOKEN" ] && [ -n "$CHAT_ID1" ]; then
         /usr/bin/curl -s -m 2 -X POST "https://api.telegram.org/bot$TOKEN/sendMessage" \
         -d chat_id="$CHAT_ID1" \
         -d parse_mode="HTML" \
         -d text="$MSG" > /dev/null 2>&1
      fi
    ) &
fi
